import subprocess

LIST = ["export GOBIN=`go env GOPATH`/bin && export PATH=$PATH:$GOBIN", "&&"]

#zwraca hash pliku/url
def hash0(file, type):
    newlist = LIST[:]
    hash = ['vt', 'scan', type]
    newlist.extend(hash)
    newlist.append(file)
    komenda = ' '.join([str(elem) for elem in newlist])
    proces = subprocess.Popen(komenda, stdout=subprocess.PIPE ,shell=True, text=True)
    file_hash, execute_nr = proces.communicate()
    if type == "file":
        file_hash = file_hash[-61:-1]
    else:
        file_hash = file_hash[-78:-1]
    analyze(file_hash)

#analiza hashu. petla poki nie bedzie gotowa analiza
def analyze(hash):
    newlist = LIST[:]
    analiza = ["vt", "an", hash, "-i=status"]
    newlist.extend(analiza)
    komenda = ' '.join([str(elem) for elem in newlist])
    print(komenda)
    proces = subprocess.Popen(komenda, stdout=subprocess.PIPE ,shell=True, text=True)
    status, nr = proces.communicate()
    status = status.replace("- status: ", ""); status = status.replace('"', '')

    while status == "completed":
        subprocess.run(["sleep", "1"])
        proces = subprocess.Popen(komenda, stdout=subprocess.PIPE ,shell=True, text=True)
        status, nr = proces.communicate()
        status = status.replace("- status: ", ""); status = status.replace('"', '')
        print(status)

    newlist = LIST[:]
    analiza = ["vt", "an"]
    analiza.append(hash)
    newlist.extend(analiza)
    newlist.append("-i=**.category -i=**.result -i=stats.**")
    komenda = ' '.join([str(elem) for elem in newlist])
    proces = subprocess.Popen(komenda, stdout=subprocess.PIPE ,shell=True, text=True)
    result, none = proces.communicate()
    result = result.replace("\n", "\n")
    print(result)


type = input("file or url?: ")
hash = "OTdjY2FjMTk5Yjg4OTMzODBlMTRiMDU4MzU5NmFiYjY6MTY0ODkyODg4Mw=="
subprocess.run(["sleep", "1"])
if type == "file":
    #file = input("Path to file: ")
    file =  "~/Desktop/whatami"
    hash0(file, type)
    #analyze(hash)
elif type == "url":
    #url = input("Full url: ")
    url = "www.virustotal.com"
    hash0(url, type)
else:
    print("Bad type!")
